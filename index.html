<!DOCTYPE HTML>
<!--
	Aerial 1.0 by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Momentum</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="description" content="" />
		<meta name="keywords" content="" />
		<!--[if lte IE 8]><script src="css/ie/html5shiv.js"></script><![endif]-->
		<script src="js/skel.min.js"></script>
		<script src="js/init.js"></script>
		<noscript>
			<link rel="stylesheet" href="css/skel.css" />
			<link rel="stylesheet" href="css/style.css" />
			<link rel="stylesheet" href="css/style-wide.css" />
			<link rel="stylesheet" href="css/style-noscript.css" />
			<link rel="stylesheet" href="css/ionic.css" />
		</noscript>

		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">

		<!-- Optional theme -->
		<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">



		<!-- Latest compiled and minified JavaScript -->
		<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
		<script src="js/dropzone.js"></script>

		<link href='http://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700' rel='stylesheet' type='text/css'>
		<!--[if lte IE 9]><link rel="stylesheet" href="css/ie/v9.css" /><![endif]-->
		<!--[if lte IE 8]><link rel="stylesheet" href="css/ie/v8.css" /><![endif]-->
		<style>
			.primary-btn {

				padding: 20px 30px 20px 30px;
				font-size: 15pt;
				border:1px solid white;
				border-radius: 40px;
				background-color: transparent;
				color:white;
				font-family:'Roboto Slab';
			}

			.form-btn {
				background-color: #16a085;
				border:0;
			}

			.post-btn {
				margin-bottom: 20px;
				margin-left: 20px;
				padding:5px;
				text-align: center;
				position:relative;
				width: 70px;
				height: 70px;
				border: 3px solid white;
				background-color: #16a085;
				font-size: 12pt;
				border-radius: 50%;
				box-shadow:
 					0 0 0 5px hsl(168, 75.8%, 35.7%);
  					/*0 0 0 15px hsl(0, 0%, 90%);*/
			}

			.cancel-btn {
				margin-bottom: 20px;
				margin-left: 20px;
				padding:5px;
				text-align: center;
				position:relative;
				width: 70px;
				height: 70px;
				border: 3px solid white;
				background-color: rgb(192, 57, 43);
				font-size: 12pt;
				border-radius: 50%;
				box-shadow:
 					0 0 0 5px rgb(192, 57, 43) /*hsl(168, 75.8%, 35.7%)*/;
  					/*0 0 0 15px hsl(0, 0%, 90%);*/
			}

/*			.post-btn:before {
			   content: " ";
			   position: absolute;
			   z-index: -1;
			   top: 5px;
			   left: 5px;
			   right: 5px;
			   bottom: 5px;
			   border: 5px solid #16a085;
			}
*/
			.primary-btn:hover {
				background-color: white;
				color:black;
			}

			button {
				width:160px;
				-webkit-transition: all 0.1s linear;
				-moz-transition: all 0.1s linear;
				-o-transition: all 0.1s linear;
				-ms-transition: all 0.1s linear;
			}

			@media(max-width:640px) {
				button {
					width: 100px;
				}

				.primary-btn {
					padding: 10px 15px 10px 15px;
					font-size: 12pt;
				}
			} 

			input {
				/*height: 40px;*/
				padding: 20px;
				width: 300px;
				border-radius: 10px;
				border:0;
				margin-top: 10px;
				font-family: 'Roboto Slab';
				font-size: 12pt;
				-webkit-transition: all 0.1s linear;
				-moz-transition: all 0.1s linear;
				-o-transition: all 0.1s linear;
				-ms-transition: all 0.1s linear;
			}

			input:focus {
				outline-style: none;
				outline-color: transparent;
				/*background-color: 3px solid #16a085;*/
			}

			button:focus {
				outline-style: none;
				outline-color: transparent;
				/*background-color: 3px solid #16a085;*/
			}

			.err {
				color:red;
				font-size: 15pt;
				/*margin-top:20px;*/
				font-weight: bold;
				font-family: 'Roboto Slab';
			}

		      .card {
		        width: 450px;
		        padding:0px;
		        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
		        background-color:white; 
		        text-align: left;
		        font-family: 'Roboto Slab';
		        overflow:scroll;

		      }

		      .card h3 {
		        padding:20px 20px 0px 20px;
		        font-weight:bold;
		        text-transform:uppercase

		      }

		      .card p.postDate {
		        padding:0px 20px 0px 20px;
		        font-weight: bold;
		      }

		      .card p.displayContent {
		        padding:6px 20px 20px 20px;
		      }

		      .card img {
		        padding:10px 0px 0px 0px;
		        width:100%;
		      }

		      textarea {
		      	margin-top: -20px;
		      	border:0;
		      	width:100%;
		      	height: 135px;
		      	padding: 20px;
		      	resize:none;
		      }

		      textarea:focus {
		      	outline-color: transparent;
		      	outline-style: none;
		      }

		      .imageDropZone {
		      	background-color:black;

		      	width: 100%;
		      	height: 200px;
		      }

		      .postTitle {
		      	padding:10px 20px 0px 20px;
		      	font-weight: bold;
		      }

		      #dropZoneArea {
		      	background-color:blue;
		      	height: 50px;
		      	width:100%;
		      }

		      #drop_zone {
		      	height: 70px;
		      	width: 90%;
		      	border: 3px dashed grey;
		      	text-align: center;
		      }
		</style>
	</head>
	<body class="loading">
		<div id="wrapper">
			<div id="bg"></div>
			<!-- <div id="overlay"></div> -->
			<div id="main">

				<!-- Header -->
					<header id="header">
						<h1 style="font-family:'Roboto Slab'; font-weight:100; color:white;"><b style="font-weight:700;">moment</b>um</h1>
						<p style="color:white; font-family:'Roboto Slab';" class="subTitleString">Capture that one moment each day.<br />Share it anonymously with the world.</p>
						<nav>
							<button class="primary-btn" id="signUpBTN">Sign Up</button>
							<button class="primary-btn" style="margin-left: 10px;" id="logInBTN">Log In</button>
						</nav>

						<div class="signUp">
							<input type="text" placeholder="Username" id="newUsername"><br />
							<input type="password" placeholder="Password" id="newPassword"><br />
							<input type="password" placeholder="Confirm Password" id="newConfirmPassword"><br /><br />
							<span class="errBoxSignUp err">Passwords don't match.</span><br /><br />
							<button class="primary-btn form-btn" id="signUpNewUser">Sign Up</button>

						</div>

						<div class="logIn">
							<input type="text" placeholder="Username" id="username"><br />
							<input type="password" placeholder="Password" id="password"><br /><br />
							<span class="errBoxLogIn err">Invalid password or username.</span><br /><br />
							<button class="primary-btn form-btn" id="logInUser">Log In</button>

						</div>



					</header>


					<!-- Modal -->
					

				<!-- Footer -->
					<footer id="footer" style="color:white;">
						<span class="copyright">&copy; Gautam Mittal. Design: <a href="http://html5up.net">HTML5 UP</a>.</span>
					</footer>
				
			</div>
		</div>

		<script type='text/javascript' src='https://cdn.firebase.com/js/client/1.0.17/firebase.js'></script>
		<script type="text/javascript" src="http://momentjs.com/downloads/moment.min.js"></script>
		<script>
			var db = new Firebase('https://momentum-db.firebaseIO.com/');
			var loggedInUserName;

			$(".signUp").hide();
			$(".logIn").hide();
			$(".err").hide();

			$("#signUpBTN").click(function() {
				$("nav").hide();
				$(".signUp").fadeIn();
			});

			$("#logInBTN").click(function() {
				$("nav").hide();
				$(".logIn").fadeIn();
			});




			$("#newConfirmPassword").keydown(function(evt) {
				if (evt.which == 13) {
					var username = document.querySelector("#newUsername").value;
					var password = document.querySelector("#newPassword").value;
					var confPassword = document.querySelector("#newConfirmPassword").value;
					createUserAccount(username, password, confPassword);

				}
			});


			$("#password").keydown(function(evt) {
				if (evt.which == 13) {
					var username = document.querySelector("#username").value;
					var password = document.querySelector("#password").value;
					logInUserAccount(username, password);

				}
			});



			$("#signUpNewUser").click(function() {
				var username = document.querySelector("#newUsername").value;
				var password = document.querySelector("#newPassword").value;
				var confPassword = document.querySelector("#newConfirmPassword").value;
				createUserAccount(username, password, confPassword);
			});

			$("#logInUser").click(function() {
				var username = document.querySelector("#username").value;
				var password = document.querySelector("#password").value;
				logInUserAccount(username, password);
			});


			function createUserAccount(usernameString, passwordString, confirmedPasswordString) {
				$(".errBoxSignUp").hide();

				var user = new Firebase('https://momentum-db.firebaseIO.com/users/' + usernameString);

				var userAlreadyCreated = false; // firebase has a tendency to loop through the .on method multiple times. This prevents it from doing that
				

				user.on("value", function(data) {
					if (userAlreadyCreated == false) {
						userAlreadyCreated = true;

	  					var username = data.val() ? data.val().username : null;
	  					// alert(username);
	  					if (username == null) {
	  						
	  						console.log("User doesn't exist, so I'll create one.");

	  						if (passwordString == confirmedPasswordString) {
	  							user.set({'username': usernameString, 'password': passwordString});
	  							document.querySelector("#newUsername").value = "";
	  							document.querySelector("#newPassword").value = "";
	  							document.querySelector("#newConfirmPassword").value = "";

	  							loggedInUserName = usernameString;
	  							redirectToFeed();
	  						} else {
	  							$('.errBoxSignUp').html('Passwords do not match.');
	  							$('.errBoxSignUp').show();
	  						}

	  					} else {

	  						$('.errBoxSignUp').html('Username is already taken.');
	  						$('.errBoxSignUp').show();
	  					}
  					}	
				});
				
			} // end createUser


			function logInUserAccount(usernameString, passwordString) {
				$(".errBoxLogIn").hide();

				var user = new Firebase('https://momentum-db.firebaseIO.com/users/' + usernameString);

				var userAlreadyCreated = false; // firebase has a tendency to loop through the .on method multiple times. This prevents it from doing that
				

				user.on("value", function(data) {
					if (userAlreadyCreated == false) {
						userAlreadyCreated = true;


	  					var username = data.val() ? data.val().username : null;
	  					var password = data.val() ? data.val().password : null;
	  					// alert(username);
	  					if (username == null) {
	  						
	  						$('.errBoxLogIn').html('User does not exist.');
	  						$('.errBoxLogIn').show();

	  					} else {

	  						if (usernameString == username && passwordString == password) {
	  							loggedInUserName = usernameString;
	  							redirectToFeed();
	  						} else {
	  							$('.errBoxLogIn').html('Invalid username or password.');
	  							$('.errBoxLogIn').show();

	  						}
	  					}
  					}	
				});
				
			} // end logIn


			function cancelCreatePost() {
				console.log("Post was successfully canceled.")
				$(".postView").remove();
				$("#header").append('<div class="postView"><center><div class=\"feed\"><div class="card"><input type="text" class="postTitle" placeholder="Title of your post"/><hr id="textareaDropZoneDivide"/><textarea placeholder="What was your one awesome moment today?" maxlength="1000"></textarea><hr /><br /><center><div id="drop_zone"><br />Drop your image here</div><output id="list"></output></center><br /><br /><button class="primary-btn post-btn" onclick="javascript: postMoment();">Post</button><button class="primary-btn cancel-btn" id="cancelBTN" onclick="javascript: cancelCreatePost();">Cancel</button></div><div class=\"publicFeed\"></div></div></center></div>');
				$("#header").append('<script type="text/javascript"\>var publicFeed = new Firebase("https://momentum-db.firebaseio.com/feed"); publicFeed.on(\'child_added\', function (snapshot) { alert(snapshot.val()); }); <\/script>')

			}

			function postMoment() {
				var feed = new Firebase('https://momentum-db.firebaseio.com/feed/');
				var personalFeed = new Firebase ('https://momentum-db.firebaseio.com/users/' + loggedInUserName + '/feed');

				var postTitle = document.querySelector(".postTitle").value;
				var postContent = document.querySelector("textarea").value;

				if (postTitle.length != 0) {

					var image = imageUploadedString;
					var date = moment().format('MMMM Do YYYY, h:mm:ss a');

					var alreadyPushed = false;

					if ($("textarea").is(":visible") == true && postContent.length != 0) {
						if (alreadyPushed == false) {
							alreadyPushed = true;
		                	feed.push({"title": postTitle, "content": postContent, "date": date, "type": "text", "likes": 0});
		                	personalFeed.push({"title": postTitle, "content": postContent, "date": date, "type": "text", "likes": 0});
	                	}

	            	} else {
	            		if (alreadyPushed == false) {
	            			alreadyPushed = true;
		            		feed.push({"title": postTitle, "content": image, "date": date, "type": "image", "likes": 0});
		                	personalFeed.push({"title": postTitle, "content": image, "date": date, "type": "image", "likes": 0});
	                	}

	            	}

            	}	
				

			}

			function redirectToFeed() {
				$("#header").animate({height: '100%'}, 1000);
				$("#header").css("overflow", "hidden");
				$("#header").css("margin-top", "40px").append("<br /><br />");
				// $("#header").css("overflow", "visible");
				$(".signUp").hide();
				$(".logIn").hide();
				// $("#header").append("<hr style=\"width:80%\" />");
				$(".subTitleString").html("Welcome, @" + loggedInUserName);
				$("#header").append('<div class="postView"><center><div class=\"feed\"><div class="card"><input type="text" class="postTitle" placeholder="Title of your post"/><hr id="textareaDropZoneDivide"/><textarea placeholder="What was your one awesome moment today?" maxlength="1000"></textarea><hr /><br /><center><div id="drop_zone"><br />Drop your image here</div><output id="list"></output></center><br /><br /><button class="primary-btn post-btn" onclick="javascript: postMoment();">Post</button><button class="primary-btn cancel-btn" id="cancelBTN" onclick="javascript: cancelCreatePost();">Cancel</button></div><div class=\"publicFeed\"></div></div></center></div>');
				$("#header").append('<script type="text/javascript"\>var publicFeed = new Firebase("https://momentum-db.firebaseio.com/feed"); publicFeed.on(\'child_added\', function (snapshot) { if (snapshot.val().type == "text") { $(".publicFeed").prepend(\'<div class="card"><h3>\' + snapshot.val().title + \'</h3><p class="postDate">\' + snapshot.val().date + \'</p><p style="color:black;" class="displayContent">\' + snapshot.val().content + \'</p></div>\'); } }); <\/script>')

				var dropZone = document.querySelector('#drop_zone');
			  	dropZone.addEventListener('dragover', handleDragOver, false);
			  	dropZone.addEventListener('drop', handleFileSelect, false);



			}

			function loadFeedCards() {


			}




			  var imageUploadedString;

			  function handleFileSelect(evt) {
			    evt.stopPropagation();
			    evt.preventDefault();

			    

			    var files = evt.dataTransfer.files; // FileList object.
			    // alert(file[0]);

			    // files is a FileList of File objects. List some properties.
			    var output = [];
			    for (var i = 0, f; f = files[i]; i++) {
			      
			    	  $("textarea").hide();
			    	  document.querySelector("textarea").value = "";

		              if (!f.type.match('image.*')) {
				        continue;
				      }

				      output.push('<li><span style="color:green; font-family:\'Roboto Slab\';">Image successfully uploaded.</span></li>');

				      var reader = new FileReader();

				      // Closure to capture the file information.
				      reader.onload = (function(theFile) {
				        return function(e) {
				          // Render thumbnail.
				          var span = document.createElement('span');

				          span.innerHTML = [e.target.result].join('');

				          imageUploadedString = e.target.result;

				          document.getElementById('list').insertBefore(span, null);
				        };
				      })(f);

				      // Read in the image file as a data URL.
				      reader.readAsDataURL(f);
			  


			    }
			   	
			    document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';
			    $("#drop_zone").hide();
			    $("#textareaDropZoneDivide").hide();

			  }


			  function handleDragOver(evt) {
			    evt.stopPropagation();
			    evt.preventDefault();
			    evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
			  }

			  // Setup the dnd listeners.
			  














		</script>
	</body>
</html>